{
    "name": "Contextual Project Analysis - Complete",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "contextual-project-analysis",
          "options": {}
        },
        "id": "f8e8e2f1-4a2c-4b6e-9c3d-8e2f1a2b3c4d",
        "name": "Webhook - Contextual Project Analysis",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1,
        "position": [200, 300],
        "webhookId": "contextual-project-webhook"
      },
      {
        "parameters": {
          "jsCode": "const payload = $input.first().json;\n\nconsole.log('üì• R√©ception analyse contextuelle');\nconsole.log('üìä Projet:', payload.project_data.metadata.name);\nconsole.log('üéØ Objectif:', payload.business_context.project_objective);\n\nif (!payload.project_data || !payload.business_context) {\n  throw new Error('Donn√©es projet ou contexte manquants');\n}\n\nif (!payload.business_context.project_objective || !payload.business_context.target_users) {\n  throw new Error('Objectif projet et utilisateurs requis');\n}\n\nconst enrichedData = {\n  ...payload,\n  analysis_scope: {\n    total_screens: payload.project_data.screens.length,\n    total_pages: payload.project_data.metadata.total_pages,\n    complexity_estimated: calculateProjectComplexity(payload.project_data.screens),\n    user_roles_detected: extractUserRoles(payload.business_context.target_users)\n  },\n  workflow_metadata: {\n    workflow_id: $workflow.id,\n    execution_id: $execution.id,\n    started_at: new Date().toISOString(),\n    analysis_type: \"contextual_comprehensive\"\n  }\n};\n\nconsole.log('‚úÖ Donn√©es enrichies et valid√©es');\nreturn [{ json: enrichedData }];\n\nfunction calculateProjectComplexity(screens) {\n  if (!screens || screens.length === 0) return 1;\n  let totalComplexity = 0;\n  screens.forEach(screen => {\n    let screenComplexity = 1;\n    if (screen.content_analysis) {\n      screenComplexity += (screen.content_analysis.interactive_elements?.length || 0) * 0.5;\n      screenComplexity += (screen.content_analysis.form_fields?.field_count || 0) * 0.3;\n      screenComplexity += (screen.connections?.length || 0) * 0.4;\n    }\n    totalComplexity += Math.min(screenComplexity, 10);\n  });\n  return Math.round(totalComplexity / screens.length * 10) / 10;\n}\n\nfunction extractUserRoles(usersString) {\n  if (!usersString) return [];\n  const roleKeywords = {\n    'admin': ['admin', 'administrateur'],\n    'client': ['client', 'utilisateur final'],\n    'commercial': ['commercial', 'vendeur'],\n    'manager': ['manager', 'responsable']\n  };\n  const detectedRoles = [];\n  const lowerUsers = usersString.toLowerCase();\n  Object.entries(roleKeywords).forEach(([role, keywords]) => {\n    if (keywords.some(keyword => lowerUsers.includes(keyword))) {\n      detectedRoles.push(role);\n    }\n  });\n  return detectedRoles.length > 0 ? detectedRoles : ['utilisateur'];\n}"
        },
        "id": "a1b2c3d4-5e6f-7g8h-9i0j-k1l2m3n4o5p6",
        "name": "Validate & Enrich Contextual Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 1,
        "position": [400, 300]
      },
      {
        "parameters": {
          "resource": "text",
          "operation": "message",
          "model": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "options": {
            "temperature": 0.2,
            "maximumTokens": 8000
          },
          "text": "# üéØ ANALYSE CONTEXTUELLE SP√âCIALIS√âE - PRODUCT MANAGER EXPERT\n\nTu es un Product Manager senior qui g√©n√®re des sp√©cifications parfaitement adapt√©es au contexte m√©tier.\n\n## üìã CONTEXTE BUSINESS\n**Objectif projet** : {{$json.business_context.project_objective}}\n**Utilisateurs cibles** : {{$json.business_context.target_users}}\n**Type de projet** : {{$json.business_context.project_type}}\n**Niveau documentation** : {{$json.business_context.detail_level}}\n**Int√©grations requises** : {{$json.business_context.required_integrations}}\n\n## üìä DONN√âES PROJET FIGMA\n**Nom projet** : {{$json.project_data.metadata.name}}\n**Nombre d'√©crans** : {{$json.project_data.screens.length}}\n**Pages d√©tect√©es** : {{$json.project_data.metadata.total_pages}}\n**Complexit√© estim√©e** : {{$json.analysis_scope.complexity_estimated}}/10\n\n### üñºÔ∏è √âcrans d√©tect√©s :\n{{#each $json.project_data.screens}}\n#### {{name}} (Page: {{page}})\n- **Screenshot** : {{screenshot_url}}\n- **√âl√©ments interactifs** : {{content_analysis.interactive_elements.length}} d√©tect√©s\n- **Connexions** : {{connections.length}} interactions\n{{/each}}\n\n## üéØ MISSION\nG√©n√®re une structure PM/PO compl√®te avec User Stories adapt√©es au contexte m√©tier.\n\n## üìù FORMAT JSON OBLIGATOIRE\n\n```json\n{\n  \"contextual_analysis\": {\n    \"business_summary\": {\n      \"project_vision\": \"[Vision adapt√©e au contexte]\",\n      \"target_outcome\": \"[R√©sultat attendu selon l'objectif]\",\n      \"success_metrics\": [\"[KPIs sp√©cifiques au m√©tier]\"],\n      \"context_alignment\": \"[Comment le projet r√©pond au contexte]\"\n    },\n    \"epics\": [\n      {\n        \"id\": \"EPIC-001\",\n        \"title\": \"Epic : [Nom adapt√© au m√©tier]\",\n        \"business_objective\": \"[Objectif align√© sur le contexte]\",\n        \"target_users\": [\"[R√¥les exacts depuis le contexte]\"],\n        \"success_criteria\": [\"[Crit√®res sp√©cifiques au domaine]\"],\n        \"context_value\": \"[Valeur dans le contexte]\",\n        \"estimated_points\": 50,\n        \"features_ids\": [\"FEAT-001\", \"FEAT-002\"]\n      }\n    ],\n    \"features\": [\n      {\n        \"id\": \"FEAT-001\",\n        \"epic_id\": \"EPIC-001\",\n        \"title\": \"Feature : [Nom contextualis√©]\",\n        \"description\": \"[Description adapt√©e au m√©tier]\",\n        \"user_value\": \"[Valeur pour les utilisateurs]\",\n        \"screens_included\": [\"[Noms des √©crans]\"],\n        \"estimated_points\": 20,\n        \"user_stories_ids\": [\"US-001\", \"US-002\"]\n      }\n    ],\n    \"user_stories\": [\n      {\n        \"id\": \"US-001\",\n        \"feature_id\": \"FEAT-001\",\n        \"title\": \"[Titre contextualis√©]\",\n        \"contextualized_story\": {\n          \"user_role\": \"[R√¥le depuis le contexte]\",\n          \"user_want\": \"[Action adapt√©e √† l'objectif]\",\n          \"user_goal\": \"[B√©n√©fice align√© sur la valeur m√©tier]\",\n          \"full_story\": \"En tant que [r√¥le], je veux [action], afin de [b√©n√©fice]\"\n        },\n        \"business_acceptance_criteria\": [\n          {\n            \"scenario\": \"[Sc√©nario m√©tier]\",\n            \"given\": \"[Contexte m√©tier]\",\n            \"when\": \"[Action dans le contexte]\",\n            \"then\": \"[R√©sultat attendu]\"\n          }\n        ],\n        \"domain_specific_rules\": [\"[R√®gles m√©tier du domaine]\"],\n        \"context_integrations\": [\"[Int√©grations bas√©es sur le contexte]\"],\n        \"complexity_analysis\": {\n          \"fibonacci_score\": 5,\n          \"complexity_factors\": [\"[Facteurs de complexit√©]\"],\n          \"context_complexity\": \"[Complexit√© due au contexte]\"\n        },\n        \"story_points\": 5,\n        \"priority\": \"High\",\n        \"screen_reference\": {\n          \"screen_name\": \"[Nom √©cran Figma]\",\n          \"figma_url\": \"[URL directe]\",\n          \"screenshot_url\": \"[URL capture]\"\n        }\n      }\n    ],\n    \"technical_specifications\": {\n      \"contextual_integrations\": [\n        {\n          \"system\": \"[Syst√®me depuis contexte]\",\n          \"purpose\": \"[Pourquoi dans ce contexte]\",\n          \"data_flow\": \"[Comment les donn√©es circulent]\",\n          \"business_impact\": \"[Impact sur l'objectif m√©tier]\"\n        }\n      ],\n      \"performance_requirements\": [\"[Selon utilisateurs et contexte]\"],\n      \"security_considerations\": [\"[Selon type projet]\"],\n      \"scalability_needs\": [\"[Selon objectifs de croissance]\"]\n    },\n    \"project_metrics\": {\n      \"total_story_points\": 150,\n      \"estimated_sprints\": 6,\n      \"estimated_duration\": \"3-4 mois\",\n      \"team_size_recommendation\": \"5-7 d√©veloppeurs\",\n      \"context_risk_level\": \"Medium\",\n      \"business_value_score\": \"High\"\n    }\n  }\n}\n```\n\n**INSTRUCTIONS CRITIQUES :**\n1. ADAPTE tout le vocabulaire au contexte m√©tier fourni\n2. UTILISE les r√¥les utilisateurs exacts mentionn√©s\n3. ALIGNE tous les objectifs sur la vision projet\n4. INT√àGRE les contraintes d'int√©gration sp√©cifi√©es\n5. G√âN√àRE des sp√©cifications ACTIONABLES\n6. BASE-TOI uniquement sur l'analyse des √©crans fournis"
        },
        "id": "b2c3d4e5-6f7g-8h9i-0j1k-l2m3n4o5p6q7",
        "name": "AI Agent - Contextual Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [600, 300],
        "credentials": {
          "openAiApi": {
            "id": "your-openai-credential-id",
            "name": "OpenAI Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiResponse = $input.first().json;\nconst contextData = $node[\"Validate & Enrich Contextual Data\"].json;\n\nconsole.log('üèóÔ∏è Structuration r√©ponse IA pour Tuleap...');\n\nlet contextualAnalysis;\ntry {\n  const aiContent = aiResponse.content || aiResponse.message?.content || aiResponse.choices?.[0]?.message?.content || aiResponse.text;\n  \n  if (!aiContent) {\n    throw new Error('Contenu IA vide');\n  }\n  \n  const jsonMatch = aiContent.match(/```json\\n([\\s\\S]*?)\\n```/);\n  if (jsonMatch) {\n    contextualAnalysis = JSON.parse(jsonMatch[1]);\n  } else {\n    contextualAnalysis = JSON.parse(aiContent);\n  }\n  \n  console.log('‚úÖ JSON IA pars√© avec succ√®s');\n  \n} catch (error) {\n  console.error('‚ùå Erreur parsing IA:', error.message);\n  throw new Error(`Erreur parsing IA: ${error.message}`);\n}\n\nif (!contextualAnalysis.contextual_analysis) {\n  throw new Error('Structure IA invalide');\n}\n\nconst analysis = contextualAnalysis.contextual_analysis;\n\nconst tuleapStructure = {\n  metadata: {\n    project_name: contextData.project_data.metadata.name,\n    figma_url: contextData.project_data.metadata.figma_url,\n    analysis_type: \"contextual_comprehensive\",\n    generated_at: new Date().toISOString(),\n    ai_model: \"gpt-4o\",\n    context_applied: contextData.business_context,\n    workflow_version: \"2.0.0\"\n  },\n  hierarchy: {\n    business_summary: analysis.business_summary,\n    epics: analysis.epics || [],\n    features: analysis.features || [],\n    user_stories: analysis.user_stories || [],\n    technical_specs: analysis.technical_specifications || {}\n  },\n  project_metrics: {\n    ...analysis.project_metrics,\n    original_screens_count: contextData.project_data.screens.length\n  },\n  tuleap_config: {\n    base_url: \"https://agile.box.africa\",\n    project_prefix: generateProjectPrefix(contextData.project_data.metadata.name),\n    trackers: {\n      epic: 365,\n      feature: 366,\n      user_story: 367,\n      specification: 369\n    },\n    tags: [\"figma-generated\", \"contextual-analysis\", contextData.business_context.project_type]\n  },\n  validation: {\n    structure_valid: validateStructure(analysis),\n    total_artifacts: calculateTotalArtifacts(analysis)\n  }\n};\n\nconsole.log(`‚úÖ Structure Tuleap pr√©par√©e: ${tuleapStructure.hierarchy.epics.length} √©pics, ${tuleapStructure.hierarchy.user_stories.length} stories`);\n\nreturn [{ json: tuleapStructure }];\n\nfunction generateProjectPrefix(projectName) {\n  return projectName.toLowerCase().replace(/[^a-z0-9\\s]/g, '').replace(/\\s+/g, '-').substring(0, 20);\n}\n\nfunction validateStructure(analysis) {\n  return analysis.epics && analysis.epics.length > 0 && analysis.user_stories && analysis.user_stories.length > 0;\n}\n\nfunction calculateTotalArtifacts(analysis) {\n  return (analysis.epics?.length || 0) + (analysis.features?.length || 0) + (analysis.user_stories?.length || 0);\n}"
        },
        "id": "c3d4e5f6-7g8h-9i0j-1k2l-m3n4o5p6q7r8",
        "name": "Process Contextual Analysis",
        "type": "n8n-nodes-base.code",
        "typeVersion": 1,
        "position": [800, 300]
      },
    {
      "parameters": {
        "jsCode": "// Cr√©ation de la hi√©rarchie compl√®te dans Tuleap avec contexte m√©tier\nconst structureData = $input.first().json;\n\nconsole.log('üèõÔ∏è Cr√©ation hi√©rarchie Tuleap contextuelle...');\nconsole.log(`üìä √Ä cr√©er: ${structureData.hierarchy.epics.length} √©pics, ${structureData.hierarchy.features.length} features, ${structureData.hierarchy.user_stories.length} stories`);\n\nconst tuleapResults = {\n  created_artifacts: {\n    epics: [],\n    features: [],\n    stories: [],\n    specifications: []\n  },\n  project_urls: {},\n  creation_summary: {},\n  context_integration: structureData.metadata.context_applied,\n  errors: []\n};\n\ntry {\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // 1. CR√âATION DES √âPICS CONTEXTUALIS√âS\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  \n  for (const epic of structureData.hierarchy.epics) {\n    console.log(`üìù Cr√©ation Epic contextualis√©: ${epic.title}`);\n    \n    const epicArtifact = await createTuleapArtifact({\n      tracker_id: structureData.tuleap_config.trackers.epic,\n      title: epic.title,\n      description: formatContextualEpicDescription(epic, structureData.metadata),\n      \n      // Champs sp√©cifiques Epic\n      business_objective: epic.business_objective,\n      target_users: epic.target_users?.join(', ') || '',\n      success_criteria: epic.success_criteria?.join('\\n') || '',\n      context_value: epic.context_value || '',\n      estimated_points: epic.estimated_points || 0,\n      \n      // M√©tadonn√©es\n      category: \"Epic\",\n      priority: \"High\",\n      status: \"New\",\n      \n      // Tags contextuels\n      tags: [\n        ...structureData.tuleap_config.tags,\n        \"epic\",\n        epic.id.toLowerCase(),\n        structureData.metadata.context_applied.project_type\n      ],\n      \n      // R√©f√©rences\n      figma_project_url: structureData.metadata.figma_url,\n      generated_from: \"figma_contextual_analysis\",\n      original_epic_id: epic.id\n    });\n    \n    tuleapResults.created_artifacts.epics.push(epicArtifact);\n  }\n  \n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // 2. CR√âATION DES FEATURES CONTEXTUALIS√âES\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  \n  for (const feature of structureData.hierarchy.features) {\n    console.log(`üìã Cr√©ation Feature contextualis√©e: ${feature.title}`);\n    \n    // Recherche de l'Epic parent\n    const parentEpic = tuleapResults.created_artifacts.epics.find(e => \n      e.original_epic_id === feature.epic_id\n    );\n    \n    const featureArtifact = await createTuleapArtifact({\n      tracker_id: structureData.tuleap_config.trackers.feature,\n      title: feature.title,\n      description: formatContextualFeatureDescription(feature, structureData.metadata),\n      \n      // Lien hi√©rarchique\n      parent_id: parentEpic?.id,\n      parent_epic: parentEpic?.title || '',\n      \n      // Champs sp√©cifiques Feature\n      user_value: feature.user_value || '',\n      screens_included: feature.screens_included?.join(', ') || '',\n      estimated_points: feature.estimated_points || 0,\n      \n      // M√©tadonn√©es\n      category: \"Feature\",\n      priority: \"Medium\",\n      status: \"New\",\n      \n      // Tags\n      tags: [\n        ...structureData.tuleap_config.tags,\n        \"feature\",\n        feature.id.toLowerCase()\n      ],\n      \n      original_feature_id: feature.id\n    });\n    \n    tuleapResults.created_artifacts.features.push(featureArtifact);\n  }\n  \n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // 3. CR√âATION DES USER STORIES CONTEXTUALIS√âES\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  \n  for (const story of structureData.hierarchy.user_stories) {\n    console.log(`üìÑ Cr√©ation User Story contextualis√©e: ${story.title}`);\n    \n    // Recherche de la Feature parente\n    const parentFeature = tuleapResults.created_artifacts.features.find(f => \n      f.original_feature_id === story.feature_id\n    );\n    \n    const storyArtifact = await createTuleapArtifact({\n      tracker_id: structureData.tuleap_config.trackers.user_story,\n      title: story.title,\n      description: formatContextualStoryDescription(story, structureData.metadata),\n      \n      // Lien hi√©rarchique\n      parent_id: parentFeature?.id,\n      parent_feature: parentFeature?.title || '',\n      \n      // Champs User Story sp√©cifiques\n      story_format: story.contextualized_story?.full_story || '',\n      user_role: story.contextualized_story?.user_role || '',\n      user_want: story.contextualized_story?.user_want || '',\n      user_goal: story.contextualized_story?.user_goal || '',\n      \n      // Crit√®res et r√®gles\n      acceptance_criteria: formatAcceptanceCriteria(story.business_acceptance_criteria),\n      business_rules: story.domain_specific_rules?.join('\\n') || '',\n      integration_requirements: story.context_integrations?.join('\\n') || '',\n      \n      // Complexit√© et estimation\n      complexity_score: story.complexity_analysis?.fibonacci_score || 1,\n      complexity_factors: story.complexity_analysis?.complexity_factors?.join(', ') || '',\n      context_complexity: story.complexity_analysis?.context_complexity || '',\n      story_points: story.story_points || 1,\n      \n      // R√©f√©rences Figma\n      figma_screen_url: story.screen_reference?.figma_url || '',\n      screenshot_url: story.screen_reference?.screenshot_url || '',\n      screen_name: story.screen_reference?.screen_name || '',\n      \n      // M√©tadonn√©es\n      category: \"User Story\",\n      priority: story.priority || \"Medium\",\n      status: \"New\",\n      \n      // Tags contextuels\n      tags: [\n        ...structureData.tuleap_config.tags,\n        \"user-story\",\n        story.id.toLowerCase(),\n        story.contextualized_story?.user_role?.toLowerCase().replace(/\\s+/g, '-') || 'user',\n        story.screen_reference?.screen_name?.toLowerCase().replace(/\\s+/g, '-') || 'screen'\n      ],\n      \n      original_story_id: story.id\n    });\n    \n    tuleapResults.created_artifacts.stories.push(storyArtifact);\n    \n    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n    // 4. CR√âATION SP√âCIFICATION TECHNIQUE pour chaque Story\n    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n    \n    const specArtifact = await createTuleapArtifact({\n      tracker_id: structureData.tuleap_config.trackers.specification,\n      title: `SPEC-${story.id.replace('US-', '')}: Sp√©cification ${story.screen_reference?.screen_name || story.title}`,\n      description: formatTechnicalSpecification(story, structureData.hierarchy.technical_specs, structureData.metadata),\n      \n      // Lien hi√©rarchique\n      parent_id: storyArtifact.id,\n      parent_story: storyArtifact.title,\n      \n      // Sp√©cifications techniques\n      technical_requirements: formatTechnicalRequirements(story, structureData.hierarchy.technical_specs),\n      integration_details: formatIntegrationDetails(story, structureData.hierarchy.technical_specs),\n      performance_criteria: extractPerformanceCriteria(story, structureData.hierarchy.technical_specs),\n      security_requirements: extractSecurityRequirements(story, structureData.hierarchy.technical_specs),\n      \n      // M√©tadonn√©es\n      category: \"Technical Specification\",\n      priority: \"Medium\",\n      status: \"New\",\n      \n      tags: [\n        ...structureData.tuleap_config.tags,\n        \"specification\",\n        \"technical\",\n        story.id.toLowerCase()\n      ],\n      \n      original_story_id: story.id\n    });\n    \n    tuleapResults.created_artifacts.specifications.push(specArtifact);\n  }\n  \n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  // 5. FINALISATION ET R√âSUM√â\n  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n  \n  tuleapResults.creation_summary = {\n    total_artifacts: Object.values(tuleapResults.created_artifacts).flat().length,\n    epics_created: tuleapResults.created_artifacts.epics.length,\n    features_created: tuleapResults.created_artifacts.features.length,\n    stories_created: tuleapResults.created_artifacts.stories.length,\n    specifications_created: tuleapResults.created_artifacts.specifications.length,\n    \n    // M√©triques du projet\n    total_story_points: structureData.project_metrics?.total_story_points || 0,\n    estimated_sprints: structureData.project_metrics?.estimated_sprints || 0,\n    estimated_duration: structureData.project_metrics?.estimated_duration || 'Non estim√©',\n    team_size_recommendation: structureData.project_metrics?.team_size_recommendation || '5-7 d√©veloppeurs',\n    \n    // Contexte int√©gr√©\n    context_integration_score: structureData.project_metrics?.context_integration_score || 0,\n    business_value_score: structureData.project_metrics?.business_value_score || 'Medium',\n    \n    // Timing\n    creation_completed_at: new Date().toISOString(),\n    creation_duration: calculateCreationDuration(structureData.metadata.generated_at)\n  };\n  \n  tuleapResults.project_urls = {\n    main_project: `${structureData.tuleap_config.base_url}/projects/${structureData.tuleap_config.project_prefix}`,\n    epics_board: `${structureData.tuleap_config.base_url}/plugins/agiledashboard/?group_id=${structureData.tuleap_config.project_prefix}&planning_id=epics`,\n    backlog: `${structureData.tuleap_config.base_url}/plugins/agiledashboard/?group_id=${structureData.tuleap_config.project_prefix}&planning_id=backlog`,\n    kanban: `${structureData.tuleap_config.base_url}/plugins/agiledashboard/?group_id=${structureData.tuleap_config.project_prefix}&planning_id=kanban`\n  };\n  \n  console.log('‚úÖ Hi√©rarchie Tuleap cr√©√©e avec succ√®s !');\n  console.log(`üìä ${tuleapResults.creation_summary.total_artifacts} artifacts cr√©√©s`);\n  console.log(`üéØ Score int√©gration contexte: ${tuleapResults.creation_summary.context_integration_score}%`);\n  \n} catch (error) {\n  console.error('‚ùå Erreur cr√©ation Tuleap:', error.message);\n  tuleapResults.errors.push({\n    error: error.message,\n    timestamp: new Date().toISOString(),\n    context: 'tuleap_creation'\n  });\n}\n\nreturn [{ json: tuleapResults }];\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// FONCTIONS DE CR√âATION TULEAP\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nasync function createTuleapArtifact(artifactData) {\n  // G√©n√©rer l'ID d'abord pour √©viter la r√©f√©rence circulaire\n  const artifactId = Math.floor(Math.random() * 10000) + 1000;\n  \n  const artifact = {\n    id: artifactId,\n    url: `${structureData.tuleap_config.base_url}/plugins/tracker/?aid=${artifactId}`,\n    created_at: new Date().toISOString(),\n    ...artifactData\n  };\n  \n  // Simulation d'appel API Tuleap (√† remplacer par un vrai appel API)\n  console.log(`üîÑ Cr√©ation artifact Tuleap: ${artifact.title} (ID: ${artifact.id})`);\n  \n  return artifact;\n}\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// FONCTIONS DE FORMATAGE\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nfunction formatContextualEpicDescription(epic, metadata) {\n  return `# ${epic.title}\n\n## üéØ Objectif m√©tier contextualis√©\n${epic.business_objective}\n\n## üë• Utilisateurs cibles\n${epic.target_users?.join(', ') || 'Non sp√©cifi√©'}\n\n## üìä Crit√®res de succ√®s sp√©cifiques\n${epic.success_criteria?.map(criteria => `- ${criteria}`).join('\\n') || 'Non d√©fini'}\n\n## üíº Valeur dans le contexte\n${epic.context_value || 'Non sp√©cifi√©e'}\n\n## üìà Estimation\n- **Story points** : ${epic.estimated_points || 0}\n- **Features incluses** : ${epic.features_ids?.length || 0}\n\n## üîó Contexte projet\n- **Objectif global** : ${metadata.context_applied.project_objective}\n- **Type de projet** : ${metadata.context_applied.project_type}\n- **Utilisateurs principaux** : ${metadata.context_applied.target_users}\n- **Int√©grations** : ${metadata.context_applied.required_integrations || 'Aucune'}\n\n## üé® R√©f√©rences\n- **Figma projet** : [Voir le projet](${metadata.figma_url})\n- **G√©n√©r√© le** : ${new Date(metadata.generated_at).toLocaleDateString()}\n\n---\n*Epic g√©n√©r√© automatiquement avec analyse contextuelle IA*\n`;\n}\n\nfunction formatContextualFeatureDescription(feature, metadata) {\n  return `# ${feature.title}\n\n## üìã Description fonctionnelle\n${feature.description || 'Non sp√©cifi√©e'}\n\n## üí° Valeur utilisateur\n${feature.user_value || 'Non sp√©cifi√©e'}\n\n## üì± √âcrans inclus\n${feature.screens_included?.map(screen => `- ${screen}`).join('\\n') || 'Non sp√©cifi√©'}\n\n## üìä Estimation\n- **Story points** : ${feature.estimated_points || 0}\n- **User Stories** : ${feature.user_stories_ids?.length || 0}\n\n## üîó Contexte m√©tier\n- **Alignement objectif** : ${metadata.context_applied.project_objective}\n- **Impact utilisateurs** : ${metadata.context_applied.target_users}\n\n---\n*Feature g√©n√©r√©e avec contexte m√©tier int√©gr√©*\n`;\n}\n\nfunction formatContextualStoryDescription(story, metadata) {\n  return `# ${story.title}\n\n## üìù User Story Contextualis√©e\n**${story.contextualized_story?.full_story || 'Story non d√©finie'}**\n\n### üë§ D√©tail des r√¥les\n- **Utilisateur** : ${story.contextualized_story?.user_role || 'Non sp√©cifi√©'}\n- **Action souhait√©e** : ${story.contextualized_story?.user_want || 'Non sp√©cifi√©e'}\n- **B√©n√©fice attendu** : ${story.contextualized_story?.user_goal || 'Non sp√©cifi√©'}\n\n## ‚úÖ Crit√®res d'acceptation m√©tier\n${story.business_acceptance_criteria?.map(criteria => `\n### ${criteria.scenario || 'Sc√©nario'}\n- **√âtant donn√©** ${criteria.given || 'contexte non d√©fini'}\n- **Quand** ${criteria.when || 'action non d√©finie'}\n- **Alors** ${criteria.then || 'r√©sultat non d√©fini'}\n`).join('\\n') || 'Crit√®res non d√©finis'}\n\n## üè¢ R√®gles m√©tier sp√©cifiques\n${story.domain_specific_rules?.map(rule => `- ${rule}`).join('\\n') || 'Aucune r√®gle sp√©cifi√©e'}\n\n## üîó Int√©grations contextuelles\n${story.context_integrations?.map(integration => `- ${integration}`).join('\\n') || 'Aucune int√©gration'}\n\n## üìä Analyse de complexit√©\n- **Score Fibonacci** : ${story.complexity_analysis?.fibonacci_score || 1}/13\n- **Story Points** : ${story.story_points || 1}\n- **Facteurs de complexit√©** : ${story.complexity_analysis?.complexity_factors?.join(', ') || 'Non analys√©s'}\n- **Complexit√© contexte** : ${story.complexity_analysis?.context_complexity || 'Non √©valu√©e'}\n\n## üé® R√©f√©rences design\n- **Figma √©cran** : [${story.screen_reference?.screen_name || '√âcran'}](${story.screen_reference?.figma_url || '#'})\n- **Screenshot** : ![Capture](${story.screen_reference?.screenshot_url || '#'})\n\n## üéØ Contexte projet\n- **Objectif global** : ${metadata.context_applied.project_objective}\n- **Utilisateurs cibles** : ${metadata.context_applied.target_users}\n- **Type de projet** : ${metadata.context_applied.project_type}\n- **Niveau requis** : ${metadata.context_applied.detail_level}\n\n## üìã M√©tadonn√©es\n- **G√©n√©r√© depuis** : ${metadata.figma_url}\n- **Date g√©n√©ration** : ${new Date(metadata.generated_at).toLocaleDateString()}\n- **Type analyse** : ${metadata.analysis_type}\n- **Mod√®le IA** : ${metadata.ai_model}\n\n---\n*User Story g√©n√©r√©e avec analyse contextuelle m√©tier compl√®te*\n`;\n}\n\nfunction formatAcceptanceCriteria(criteria) {\n  if (!criteria || criteria.length === 0) {\n    return 'Crit√®res d\\'acceptation √† d√©finir';\n  }\n  \n  return criteria.map(criterion => `\n### ${criterion.scenario || 'Sc√©nario'}\n- √âtant donn√© ${criterion.given || 'contexte'}\n- Quand ${criterion.when || 'action'}\n- Alors ${criterion.then || 'r√©sultat'}\n`).join('\\n');\n}\n\nfunction formatTechnicalSpecification(story, technicalSpecs, metadata) {\n  return `# SPEC-${story.id.replace('US-', '')}: Sp√©cification technique\n\n## üìã User Story li√©e\n**${story.contextualized_story?.full_story || story.title}**\n\n## ‚öôÔ∏è Sp√©cifications techniques d√©taill√©es\n\n### Int√©grations syst√®me\n${story.context_integrations?.map(integration => `- **${integration}** : Int√©gration requise selon le contexte m√©tier`).join('\\n') || 'Aucune int√©gration sp√©cifique'}\n\n### R√®gles de validation\n${story.business_acceptance_criteria?.map(criteria => `- **${criteria.scenario}** : Validation ${criteria.then}`).join('\\n') || 'Validations standards'}\n\n### Performance attendue\n${technicalSpecs?.performance_requirements?.map(perf => `- ${perf}`).join('\\n') || '- Temps de r√©ponse < 2s\\n- Interface r√©active'}\n\n### S√©curit√©\n${technicalSpecs?.security_considerations?.map(security => `- ${security}`).join('\\n') || '- Authentification requise\\n- Validation c√¥t√© serveur'}\n\n### √âtats de l'interface\n- **Loading** : Affichage pendant traitement\n- **Success** : Confirmation d'action r√©ussie  \n- **Error** : Gestion des erreurs avec messages clairs\n- **Empty** : √âtat vide avec guidage utilisateur\n\n## üîó Contexte d'impl√©mentation\n- **Objectif projet** : ${metadata.context_applied.project_objective}\n- **Utilisateurs** : ${metadata.context_applied.target_users}\n- **Int√©grations contextuelles** : ${metadata.context_applied.required_integrations || 'Aucune'}\n\n## üé® R√©f√©rence design\n- **Figma** : [${story.screen_reference?.screen_name}](${story.screen_reference?.figma_url})\n- **Screenshot** : ![Interface](${story.screen_reference?.screenshot_url})\n\n---\n*Sp√©cification technique g√©n√©r√©e avec contexte m√©tier*\n`;\n}\n\nfunction formatTechnicalRequirements(story, technicalSpecs) {\n  const requirements = [];\n  \n  if (story.context_integrations?.length > 0) {\n    requirements.push(`Int√©grations: ${story.context_integrations.join(', ')}`);\n  }\n  \n  if (technicalSpecs?.contextual_integrations?.length > 0) {\n    requirements.push(`APIs: ${technicalSpecs.contextual_integrations.map(i => i.system).join(', ')}`);\n  }\n  \n  requirements.push(`Complexit√©: ${story.complexity_analysis?.fibonacci_score || 1}/13`);\n  requirements.push(`Points: ${story.story_points || 1}`);\n  \n  return requirements.join('\\n');\n}\n\nfunction formatIntegrationDetails(story, technicalSpecs) {\n  if (!technicalSpecs?.contextual_integrations) {\n    return 'Aucune int√©gration sp√©cifique';\n  }\n  \n  return technicalSpecs.contextual_integrations.map(integration => \n    `**${integration.system}** : ${integration.purpose} - ${integration.business_impact}`\n  ).join('\\n');\n}\n\nfunction extractPerformanceCriteria(story, technicalSpecs) {\n  const criteria = technicalSpecs?.performance_requirements || [];\n  if (criteria.length === 0) {\n    return 'Performance standard requise';\n  }\n  return criteria.join('\\n');\n}\n\nfunction extractSecurityRequirements(story, technicalSpecs) {\n  const security = technicalSpecs?.security_considerations || [];\n  if (security.length === 0) {\n    return 'S√©curit√© standard requise';\n  }\n  return security.join('\\n');\n}\n\nfunction calculateCreationDuration(startTime) {\n  const duration = Date.now() - new Date(startTime).getTime();\n  return `${Math.round(duration / 1000 / 60)} minutes`;\n}"
      },
      "id": "d4e5f6g7-8h9i-0j1k-2l3m-n4o5p6q7r8s9",
      "name": "Create Complete Tuleap Hierarchy",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1000, 300]
    },
    {
      "parameters": {
        "jsCode": "// Notifications et finalisation de l'analyse contextuelle\nconst tuleapResults = $input.first().json;\nconst originalRequest = $node[\"Validate & Enrich Contextual Data\"].json;\n\nconsole.log('üì¨ Finalisation et notifications...');\n\n// Calcul de la dur√©e totale\nconst totalDuration = calculateTotalDuration(originalRequest.workflow_metadata.started_at);\n\n// Pr√©paration du r√©sum√© complet\nconst completionSummary = {\n  // R√©sum√© ex√©cutif\n  executive_summary: {\n    project_name: originalRequest.project_data.metadata.name,\n    analysis_type: \"contextual_comprehensive\",\n    total_duration: totalDuration,\n    completion_status: tuleapResults.errors.length === 0 ? \"success\" : \"partial_success\",\n    ai_confidence: \"high\",\n    context_integration: \"complete\"\n  },\n  \n  // M√©tadonn√©es du contexte appliqu√©\n  applied_context: {\n    project_objective: originalRequest.business_context.project_objective,\n    target_users: originalRequest.business_context.target_users,\n    project_type: originalRequest.business_context.project_type,\n    detail_level: originalRequest.business_context.detail_level,\n    integrations_required: originalRequest.business_context.required_integrations\n  },\n  \n  // Livrables cr√©√©s\n  deliverables: {\n    epics_created: tuleapResults.creation_summary?.epics_created || 0,\n    features_created: tuleapResults.creation_summary?.features_created || 0,\n    stories_created: tuleapResults.creation_summary?.stories_created || 0,\n    specifications_created: tuleapResults.creation_summary?.specifications_created || 0,\n    total_artifacts: tuleapResults.creation_summary?.total_artifacts || 0\n  },\n  \n  // Estimation projet\n  project_estimation: {\n    total_story_points: tuleapResults.creation_summary?.total_story_points || 0,\n    estimated_sprints: tuleapResults.creation_summary?.estimated_sprints || 0,\n    estimated_duration: tuleapResults.creation_summary?.estimated_duration || 'Non estim√©',\n    team_size_recommendation: tuleapResults.creation_summary?.team_size_recommendation || '5-7 d√©veloppeurs',\n    business_value_score: tuleapResults.creation_summary?.business_value_score || 'Medium'\n  },\n  \n  // Qualit√© de l'analyse\n  quality_metrics: {\n    context_integration_score: tuleapResults.creation_summary?.context_integration_score || 0,\n    completeness_score: calculateCompletenessScore(tuleapResults),\n    structure_coherence: validateStructureCoherence(tuleapResults),\n    figma_traceability: \"complete\"\n  },\n  \n  // Liens d'acc√®s\n  access_links: {\n    tuleap_project: tuleapResults.project_urls?.main_project,\n    epics_board: tuleapResults.project_urls?.epics_board,\n    backlog: tuleapResults.project_urls?.backlog,\n    kanban: tuleapResults.project_urls?.kanban,\n    figma_source: originalRequest.project_data.metadata.figma_url\n  },\n  \n  // Recommandations next steps\n  next_steps: generateContextualNextSteps(originalRequest.business_context, tuleapResults),\n  \n  // Erreurs √©ventuelles\n  issues: tuleapResults.errors || [],\n  \n  // M√©tadonn√©es workflow\n  workflow_metadata: {\n    workflow_id: originalRequest.workflow_metadata.workflow_id,\n    execution_id: originalRequest.workflow_metadata.execution_id,\n    completed_at: new Date().toISOString(),\n    processing_time: totalDuration,\n    screens_processed: originalRequest.analysis_scope.total_screens,\n    ai_model_used: \"gpt-4o\"\n  }\n};\n\n// Notifications\nconst notifications = {\n  plugin_callback: await notifyFigmaPlugin(completionSummary),\n  email_sent: await sendCompletionEmail(completionSummary),\n  monitoring_updated: await updateMonitoringDashboard(completionSummary)\n};\n\n// Log final\nconsole.log('‚úÖ Analyse contextuelle termin√©e avec succ√®s !');\nconsole.log(`üìä ${completionSummary.deliverables.total_artifacts} artifacts cr√©√©s en ${totalDuration}`);\nconsole.log(`üéØ Score int√©gration contexte: ${completionSummary.quality_metrics.context_integration_score}%`);\nconsole.log(`üìã Projet Tuleap: ${completionSummary.access_links.tuleap_project}`);\n\n// R√©sultat final\nconst finalResult = {\n  ...completionSummary,\n  notifications: notifications,\n  success: true,\n  message: `Analyse contextuelle termin√©e: ${completionSummary.deliverables.total_artifacts} artifacts cr√©√©s`\n};\n\nreturn [{ json: finalResult }];\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// FONCTIONS UTILITAIRES\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nfunction calculateTotalDuration(startTime) {\n  const duration = Date.now() - new Date(startTime).getTime();\n  const minutes = Math.round(duration / 1000 / 60);\n  return `${minutes} minute${minutes > 1 ? 's' : ''}`;\n}\n\nfunction calculateCompletenessScore(results) {\n  if (!results.created_artifacts) return 0;\n  \n  const totalCreated = Object.values(results.created_artifacts).flat().length;\n  const expectedMin = 10; // Minimum attendu pour un projet complet\n  \n  return Math.min(Math.round((totalCreated / expectedMin) * 100), 100);\n}\n\nfunction validateStructureCoherence(results) {\n  if (!results.created_artifacts) return 'incomplete';\n  \n  const hasEpics = results.created_artifacts.epics.length > 0;\n  const hasFeatures = results.created_artifacts.features.length > 0;\n  const hasStories = results.created_artifacts.stories.length > 0;\n  const hasSpecs = results.created_artifacts.specifications.length > 0;\n  \n  if (hasEpics && hasFeatures && hasStories && hasSpecs) {\n    return 'complete';\n  } else if (hasEpics && hasStories) {\n    return 'partial';\n  } else {\n    return 'incomplete';\n  }\n}\n\nfunction generateContextualNextSteps(context, results) {\n  const steps = [\n    `R√©viser les ${results.creation_summary?.epics_created || 0} √©pics cr√©√©s dans Tuleap`,\n    `Planifier le backlog avec les ${results.creation_summary?.stories_created || 0} user stories`\n  ];\n  \n  if (context.required_integrations) {\n    steps.push(`Configurer les int√©grations avec ${context.required_integrations}`);\n  }\n  \n  steps.push('Organiser une r√©union de revue des sp√©cifications techniques');\n  steps.push('Valider les crit√®res d\\acceptation avec les parties prenantes');\n  \n  return steps;\n}\n\nasync function notifyFigmaPlugin(summary) {\n  console.log('üì≤ Notification au plugin Figma...');\n  // Simulation d'un appel de callback au plugin\n  return {\n    sent: true,\n    timestamp: new Date().toISOString(),\n    message: `Analyse termin√©e: ${summary.deliverables.total_artifacts} artifacts cr√©√©s`\n  };\n}\n\nasync function sendCompletionEmail(summary) {\n  console.log('üìß Envoi email de compl√©tion...');\n  // Simulation d'envoi d'email\n  return {\n    sent: true,\n    recipients: ['pm@example.com', 'dev-team@example.com'],\n    subject: `Analyse contextuelle termin√©e: ${summary.executive_summary.project_name}`\n  };\n}\n\nasync function updateMonitoringDashboard(summary) {\n  console.log('üìä Mise √† jour dashboard monitoring...');\n  // Simulation mise √† jour dashboard\n  return {\n    updated: true,\n    dashboard: 'https://monitoring.example.com/figma-integrations',\n    metrics_updated: ['completion_rate', 'context_score', 'artifacts_created']\n  };\n}"
      },
      "id": "e5f6g7h8-9i0j-1k2l-3m4n-o5p6q7r8s9t0",
      "name": "Send Completion Notifications",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1200, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({\n  \"success\": true,\n  \"message\": \"Analyse contextuelle termin√©e avec succ√®s\",\n  \"workflow_id\": $json.workflow_metadata.workflow_id,\n  \"execution_id\": $json.workflow_metadata.execution_id,\n  \"duration\": $json.executive_summary.total_duration,\n  \"artifacts_created\": $json.deliverables.total_artifacts,\n  \"tuleap_project_url\": $json.access_links.tuleap_project,\n  \"figma_source\": $json.access_links.figma_source,\n  \"context_integration_score\": $json.quality_metrics.context_integration_score,\n  \"estimated_sprints\": $json.project_estimation.estimated_sprints,\n  \"next_steps\": $json.next_steps\n}, null, 2) }}"
      },
      "id": "f6g7h8i9-0j1k-2l3m-4n5o-p6q7r8s9t0u1",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1400, 300]
    }
  ],
  "connections": {
    "Webhook - Contextual Project Analysis": {
      "main": [
        [
          {
            "node": "Validate & Enrich Contextual Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate & Enrich Contextual Data": {
      "main": [
        [
          {
            "node": "AI Agent - Contextual Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Contextual Analysis": {
      "main": [
        [
          {
            "node": "Process Contextual Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Contextual Analysis": {
      "main": [
        [
          {
            "node": "Create Complete Tuleap Hierarchy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Complete Tuleap Hierarchy": {
      "main": [
        [
          {
            "node": "Send Completion Notifications",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Completion Notifications": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": {
      "errorWorkflow": "error-handler-workflow"
    }
  },
  "staticData": {},
  "tags": [
    {
      "id": "contextual-analysis",
      "name": "Contextual Analysis"
    },
    {
      "id": "figma-integration", 
      "name": "Figma Integration"
    },
    {
      "id": "tuleap-automation",
      "name": "Tuleap Automation"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-01-15T10:30:00.000Z",
  "versionId": "v1.0.0"
}